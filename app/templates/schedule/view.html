{% extends 'base.html' %}

{% block title %}SÄ±nav ProgramÄ±{% endblock %}

{% block content %}
<section class="admin-section">
    <div class="container">
        <!-- Sayfa BaÅŸlÄ±ÄŸÄ± -->
        <div class="page-header">
            <h1>ğŸ“… SÄ±nav ProgramÄ±</h1>
            {% if session.get('role') == 'admin' %}
            <div class="header-actions">
                <a href="{{ url_for('schedule.generate') }}" class="btn btn-primary">
                    ğŸ¤– Otomatik Planla
                </a>
                <a href="{{ url_for('schedule.clear_schedule') }}" class="btn btn-danger"
                    onclick="return confirm('TÃ¼m sÄ±nav programÄ±nÄ± silmek istediÄŸinize emin misiniz?')">
                    ğŸ—‘ï¸ ProgramÄ± Temizle
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Ä°statistikler -->
        <div class="stats-row">
            <div class="stat-item">
                <span class="stat-number">{{ stats.total_exams }}</span>
                <span class="stat-label">PlanlanmÄ±ÅŸ SÄ±nav</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ stats.exam_days }}</span>
                <span class="stat-label">SÄ±nav GÃ¼nÃ¼</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ stats.used_classrooms }}</span>
                <span class="stat-label">KullanÄ±lan Derslik</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ stats.unplanned_courses }}</span>
                <span class="stat-label">PlanlanmamÄ±ÅŸ Ders</span>
            </div>
        </div>

        <!-- Filtre ve Export -->
        <div class="filter-export-row">
            <!-- BÃ¶lÃ¼m Filtresi -->
            <div class="filter-section">
                <label for="department-filter">BÃ¶lÃ¼me GÃ¶re Filtrele:</label>
                <select id="department-filter" onchange="filterByDepartment(this.value)">
                    <option value="">TÃ¼m BÃ¶lÃ¼mler</option>
                    {% for dept in departments %}
                    <option value="{{ dept.id }}" {{ 'selected' if selected_department==dept.id else '' }}>
                        {{ dept.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Export ButonlarÄ± -->
            {% if exams|length > 0 %}
            <div class="export-buttons">
                <a href="{{ url_for('schedule.export_pdf') }}" class="btn btn-export">
                    ğŸ“„ PDF Ä°ndir
                </a>
                <a href="{{ url_for('schedule.export_excel') }}" class="btn btn-export btn-excel">
                    ğŸ“Š Excel Ä°ndir
                </a>
            </div>
            {% endif %}
        </div>

        <!-- SÄ±nav Tablosu -->
        <div class="card">
            {% if exams|length > 0 %}
            <table class="table schedule-table">
                <thead>
                    <tr>
                        <th>Tarih</th>
                        <th>Saat</th>
                        <th>Ders Kodu</th>
                        <th>Ders AdÄ±</th>
                        <th>BÃ¶lÃ¼m</th>
                        <th>Dersin HocasÄ±</th>
                        <th>Derslik</th>
                        <th>GÃ¶zetmen</th>
                        <th>Ã–ÄŸrenci</th>
                        {% if session.get('role') == 'admin' %}
                        <th>Ä°ÅŸlem</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for exam in exams %}
                    <tr>
                        <td>
                            <strong>{{ exam.exam_date }}</strong>
                        </td>
                        <td>{{ exam.start_time }} - {{ exam.end_time }}</td>
                        <td><span class="badge badge-primary">{{ exam.course_code }}</span></td>
                        <td>{{ exam.course_name }}</td>
                        <td>{{ exam.department_name }}</td>
                        <td><strong>{{ exam.instructor_name }}</strong></td>
                        <td><span class="badge">{{ exam.classroom_name }}</span></td>
                        <td>{{ exam.supervisor_name or '-' }}</td>
                        <td>{{ exam.student_count }}</td>
                        {% if session.get('role') == 'admin' %}
                        <td>
                            <a href="{{ url_for('schedule.delete_single_exam', exam_id=exam.id) }}"
                                class="btn btn-sm btn-delete"
                                onclick="return confirm('Bu sÄ±navÄ± silmek istediÄŸinize emin misiniz?')">
                                ğŸ—‘ï¸</a>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">ğŸ“…</div>
                <h3>HenÃ¼z sÄ±nav planlanmamÄ±ÅŸ</h3>
                <p>Otomatik planlama yaparak sÄ±nav programÄ± oluÅŸturabilirsiniz.</p>
                {% if session.get('role') == 'admin' %}
                <a href="{{ url_for('schedule.generate') }}" class="btn btn-primary">
                    ğŸ¤– Åimdi Planla
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Geri Butonu -->
        <div class="back-link">
            <a href="{{ url_for('auth.dashboard') }}">â† Panele DÃ¶n</a>
        </div>
    </div>
</section>

<script>
    function filterByDepartment(departmentId) {
        if (departmentId) {
            window.location.href = '/schedule/view/department/' + departmentId;
        } else {
            window.location.href = '/schedule/view';
        }
    }
</script>
{% endblock %}